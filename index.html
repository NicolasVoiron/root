
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>FactoryCast Display</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #3e4042; }
        #viewer { width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center; transition: opacity 1s; opacity: 0; }
        #msg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #3dcd58; font-family: sans-serif; }
    </style>
</head>
<body>
    <div id="msg">Initialisation Schneider Electric...</div>
    <div id="viewer"></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const canal = params.get('canal') || 'bureau';
        let images = [];
        let index = 0;

        async function load() {
            try {
                const res = await fetch('config.json?v=' + Date.now());
                const data = await res.json();
                if (data.channels[canal]) {
                    images = data.channels[canal].sites
                        .filter(s => s.active !== false && s.url !== "")
                        .map((s, i) => ({
                            url: `docs/screens/${canal}_${i}.png?v=` + Date.now(),
                            dur: (s.display_time || 30) * 1000
                        }));
                    if (images.length > 0) {
                        document.getElementById('msg').style.display = 'none';
                        show();
                    } else { document.getElementById('msg').innerText = "Aucun site actif."; }
                }
            } catch (e) { 
                document.getElementById('msg').innerText = "Erreur de connexion GitHub. RÃ©essai..."; 
                setTimeout(load, 5000);
            }
        }

        function show() {
            const v = document.getElementById('viewer');
            v.style.opacity = 0;
            setTimeout(() => {
                v.style.backgroundImage = `url('${images[index].url}')`;
                v.style.opacity = 1;
                setTimeout(() => {
                    index = (index + 1) % images.length;
                    show();
                }, images[index].dur);
            }, 1000);
        }
        load();
    </script>
</body>
</html>