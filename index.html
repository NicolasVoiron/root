<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Display Schneider</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #3e4042; }
        #viewer { width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center; transition: opacity 1s; }
        #msg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #3dcd58; font-family: sans-serif; font-weight: bold; }
    </style>
</head>
<body>
    <div id="msg">Connexion Ã  GitHub en cours...</div>
    <div id="viewer"></div>
    <script>
        const params = new URLSearchParams(window.location.search);
        const canal = params.get('canal') || 'bureau';
        let images = [];
        let index = 0;

        async function start() {
            try {
                const res = await fetch('config.json?t=' + Date.now());
                if (!res.ok) throw new Error();
                const data = await res.json();
                if (data.channels[canal]) {
                    images = data.channels[canal].sites
                        .filter(s => s.active !== false && s.url !== "")
                        .map((s, i) => ({
                            url: `docs/screens/${canal}_${i}.png?v=` + Date.now(),
                            dur: (s.display_time || 30) * 1000
                        }));
                    if (images.length > 0) {
                        document.getElementById('msg').style.display = 'none';
                        rotate();
                        return;
                    }
                }
                document.getElementById('msg').innerText = "Canal vide ou inexistant.";
            } catch (e) {
                document.getElementById('msg').innerText = "Attente du fichier config.json sur GitHub...";
                setTimeout(start, 5000);
            }
        }

        function rotate() {
            const v = document.getElementById('viewer');
            v.style.opacity = 0;
            setTimeout(() => {
                v.style.backgroundImage = `url('${images[index].url}')`;
                v.style.opacity = 1;
                setTimeout(() => {
                    index = (index + 1) % images.length;
                    rotate();
                }, images[index].dur);
            }, 1000);
        }
        start();
    </script>
</body>
</html>